PREHOOK: query: explain cbo
select  i_item_desc
      ,w_warehouse_name
      ,d1.d_week_seq
      ,count(case when p_promo_sk is null then 1 else 0 end) no_promo
      ,count(case when p_promo_sk is not null then 1 else 0 end) promo
      ,count(*) total_cnt
from catalog_sales
join inventory on (cs_item_sk = inv_item_sk)
join warehouse on (w_warehouse_sk=inv_warehouse_sk)
join item on (i_item_sk = cs_item_sk)
join customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)
join household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)
join date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)
join date_dim d2 on (inv_date_sk = d2.d_date_sk)
join date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)
left outer join promotion on (cs_promo_sk=p_promo_sk)
left outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number)
where d1.d_week_seq = d2.d_week_seq
  and inv_quantity_on_hand < cs_quantity 
  and d3.d_date > d1.d_date + 5
  and hd_buy_potential = '1001-5000'
  and d1.d_year = 2001
  and hd_buy_potential = '1001-5000'
  and cd_marital_status = 'M'
  and d1.d_year = 2001
group by i_item_desc,w_warehouse_name,d1.d_week_seq
order by total_cnt desc, i_item_desc, w_warehouse_name, d_week_seq
limit 100
PREHOOK: type: QUERY
PREHOOK: Input: default@catalog_returns
PREHOOK: Input: default@catalog_sales
PREHOOK: Input: default@customer_demographics
PREHOOK: Input: default@date_dim
PREHOOK: Input: default@household_demographics
PREHOOK: Input: default@inventory
PREHOOK: Input: default@item
PREHOOK: Input: default@promotion
PREHOOK: Input: default@warehouse
PREHOOK: Output: hdfs://### HDFS PATH ###
POSTHOOK: query: explain cbo
select  i_item_desc
      ,w_warehouse_name
      ,d1.d_week_seq
      ,count(case when p_promo_sk is null then 1 else 0 end) no_promo
      ,count(case when p_promo_sk is not null then 1 else 0 end) promo
      ,count(*) total_cnt
from catalog_sales
join inventory on (cs_item_sk = inv_item_sk)
join warehouse on (w_warehouse_sk=inv_warehouse_sk)
join item on (i_item_sk = cs_item_sk)
join customer_demographics on (cs_bill_cdemo_sk = cd_demo_sk)
join household_demographics on (cs_bill_hdemo_sk = hd_demo_sk)
join date_dim d1 on (cs_sold_date_sk = d1.d_date_sk)
join date_dim d2 on (inv_date_sk = d2.d_date_sk)
join date_dim d3 on (cs_ship_date_sk = d3.d_date_sk)
left outer join promotion on (cs_promo_sk=p_promo_sk)
left outer join catalog_returns on (cr_item_sk = cs_item_sk and cr_order_number = cs_order_number)
where d1.d_week_seq = d2.d_week_seq
  and inv_quantity_on_hand < cs_quantity 
  and d3.d_date > d1.d_date + 5
  and hd_buy_potential = '1001-5000'
  and d1.d_year = 2001
  and hd_buy_potential = '1001-5000'
  and cd_marital_status = 'M'
  and d1.d_year = 2001
group by i_item_desc,w_warehouse_name,d1.d_week_seq
order by total_cnt desc, i_item_desc, w_warehouse_name, d_week_seq
limit 100
POSTHOOK: type: QUERY
POSTHOOK: Input: default@catalog_returns
POSTHOOK: Input: default@catalog_sales
POSTHOOK: Input: default@customer_demographics
POSTHOOK: Input: default@date_dim
POSTHOOK: Input: default@household_demographics
POSTHOOK: Input: default@inventory
POSTHOOK: Input: default@item
POSTHOOK: Input: default@promotion
POSTHOOK: Input: default@warehouse
POSTHOOK: Output: hdfs://### HDFS PATH ###
CBO PLAN:
HiveSortLimit(sort0=[$5], sort1=[$0], sort2=[$1], sort3=[$2], dir0=[DESC-nulls-last], dir1=[ASC], dir2=[ASC], dir3=[ASC], fetch=[100])
  HiveProject(i_item_desc=[$1], w_warehouse_name=[$0], d_week_seq=[$2], $f3=[$3], $f4=[$4], $f5=[$5])
    HiveAggregate(group=[{2, 3, 4}], agg#0=[count($5)], agg#1=[count($6)], agg#2=[count()])
      HiveProject(cs_item_sk=[$2], cs_order_number=[$4], w_warehouse_name=[$5], i_item_desc=[$6], d_week_seq=[$7], $f5=[CASE(IS NULL($9), 1, 0)], $f6=[CASE(IS NOT NULL($9), 1, 0)], cr_item_sk=[$0], cr_order_number=[$1])
        HiveJoin(condition=[=($3, $8)], joinType=[inner], algorithm=[none], cost=[not available])
          HiveJoin(condition=[AND(=($0, $2), =($1, $4))], joinType=[right], algorithm=[none], cost=[not available])
            HiveProject(cr_item_sk=[$2], cr_order_number=[$16])
              HiveTableScan(table=[[default, catalog_returns]], table:alias=[catalog_returns])
            HiveProject(cs_item_sk=[$1], cs_promo_sk=[$2], cs_order_number=[$3], w_warehouse_name=[$5], i_item_desc=[$6], d_week_seq=[$7])
              HiveJoin(condition=[AND(=($0, $11), >($12, $8))], joinType=[inner], algorithm=[none], cost=[not available])
                HiveJoin(condition=[AND(=($4, $9), =($7, $10))], joinType=[inner], algorithm=[none], cost=[not available])
                  HiveProject(cs_ship_date_sk=[$1], cs_item_sk=[$3], cs_promo_sk=[$4], cs_order_number=[$5], inv_date_sk=[$6], w_warehouse_name=[$7], i_item_desc=[$8], d_week_seq=[$10], +=[$11])
                    HiveJoin(condition=[=($2, $12)], joinType=[inner], algorithm=[none], cost=[not available])
                      HiveJoin(condition=[=($0, $9)], joinType=[inner], algorithm=[none], cost=[not available])
                        HiveProject(cs_sold_date_sk=[$0], cs_ship_date_sk=[$1], cs_bill_hdemo_sk=[$3], cs_item_sk=[$4], cs_promo_sk=[$5], cs_order_number=[$6], inv_date_sk=[$7], w_warehouse_name=[$8], i_item_desc=[$11])
                          HiveJoin(condition=[=($10, $4)], joinType=[inner], algorithm=[none], cost=[not available])
                            HiveJoin(condition=[=($2, $9)], joinType=[inner], algorithm=[none], cost=[not available])
                              HiveProject(cs_sold_date_sk=[$0], cs_ship_date_sk=[$1], cs_bill_cdemo_sk=[$2], cs_bill_hdemo_sk=[$3], cs_item_sk=[$4], cs_promo_sk=[$5], cs_order_number=[$6], inv_date_sk=[$8], w_warehouse_name=[$13])
                                HiveJoin(condition=[AND(=($4, $9), <($11, $7))], joinType=[inner], algorithm=[none], cost=[not available])
                                  HiveProject(cs_sold_date_sk=[$0], cs_ship_date_sk=[$2], cs_bill_cdemo_sk=[$4], cs_bill_hdemo_sk=[$5], cs_item_sk=[$15], cs_promo_sk=[$16], cs_order_number=[$17], cs_quantity=[$18])
                                    HiveFilter(condition=[AND(IS NOT NULL($4), IS NOT NULL($5), IS NOT NULL($0), IS NOT NULL($2), IS NOT NULL($16))])
                                      HiveTableScan(table=[[default, catalog_sales]], table:alias=[catalog_sales])
                                  HiveJoin(condition=[=($4, $2)], joinType=[inner], algorithm=[none], cost=[not available])
                                    HiveProject(inv_date_sk=[$0], inv_item_sk=[$1], inv_warehouse_sk=[$2], inv_quantity_on_hand=[$3])
                                      HiveTableScan(table=[[default, inventory]], table:alias=[inventory])
                                    HiveProject(w_warehouse_sk=[$0], w_warehouse_name=[$2])
                                      HiveTableScan(table=[[default, warehouse]], table:alias=[warehouse])
                              HiveProject(cd_demo_sk=[$0])
                                HiveFilter(condition=[=($2, _UTF-16LE'M')])
                                  HiveTableScan(table=[[default, customer_demographics]], table:alias=[customer_demographics])
                            HiveProject(i_item_sk=[$0], i_item_desc=[$4])
                              HiveTableScan(table=[[default, item]], table:alias=[item])
                        HiveProject(d_date_sk=[$0], d_week_seq=[$4], +=[+(CAST($2):DOUBLE, 5)])
                          HiveFilter(condition=[AND(=($6, 2001), IS NOT NULL($4))])
                            HiveTableScan(table=[[default, date_dim]], table:alias=[d1])
                      HiveProject(hd_demo_sk=[$0])
                        HiveFilter(condition=[=($2, _UTF-16LE'1001-5000')])
                          HiveTableScan(table=[[default, household_demographics]], table:alias=[household_demographics])
                  HiveProject(d_date_sk=[$0], d_week_seq=[$4])
                    HiveFilter(condition=[IS NOT NULL($4)])
                      HiveTableScan(table=[[default, date_dim]], table:alias=[d2])
                HiveProject(d_date_sk=[$0], CAST=[CAST($2):DOUBLE])
                  HiveTableScan(table=[[default, date_dim]], table:alias=[d3])
          HiveProject(p_promo_sk=[$0], CAST=[CAST($0):INTEGER])
            HiveTableScan(table=[[default, promotion]], table:alias=[promotion])

